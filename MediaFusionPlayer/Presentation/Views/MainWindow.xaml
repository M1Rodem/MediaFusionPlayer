<Window x:Class="MediaFusionPlayer.Presentation.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="clr-namespace:MediaFusionPlayer.Presentation.Views.Controls"
        xmlns:converters="clr-namespace:MediaFusionPlayer.Presentation.Converters"
        Title="MediaFusionPlayer" Height="720" Width="1280"
        Background="#1E1E1E" WindowStartupLocation="CenterScreen"
        AllowDrop="True" Drop="Window_Drop" DragOver="Window_DragOver">

    <Window.Resources>
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter"/>
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="250"/>
            <RowDefinition Height="10"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="100"/>
        </Grid.RowDefinitions>

        <!-- Заголовок -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,20">
            <TextBlock Text="MediaFusionPlayer" FontSize="32" Foreground="White" FontWeight="Bold"/>
            <Button Content="Добавить файлы" Command="{Binding AddFilesCommand}"
                Margin="30,0,0,0" Width="180" Height="45"
                Background="#007ACC" Foreground="White" FontSize="16"/>
        </StackPanel>

        <!-- КОНТЕЙНЕР ВИДЕО С ЖЕСТКИМ ОГРАНИЧЕНИЕМ -->
        <Grid Grid.Row="1" ClipToBounds="True">
            <!-- Основной контейнер -->
            <Border x:Name="VideoOuterContainer"
                    Background="#252525" 
                    CornerRadius="8"
                    ClipToBounds="True"
                    Width="1200"
                    Height="250"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center">

                <!-- Внутренний контейнер -->
                <Border Background="Black" 
                        CornerRadius="6"
                        ClipToBounds="True"
                        Margin="2">

                    <!-- Grid для содержимого -->
                    <Grid ClipToBounds="True">

                        <!-- Видео -->
                        <controls:VideoView 
                            x:Name="VideoViewControl"
                            VideoService="{Binding VideoService}"
                            Visibility="{Binding IsVideo, Converter={StaticResource BooleanToVisibilityConverter}}"
                            Background="Black"
                            ClipToBounds="True"/>

                        <!-- Визуализатор -->
                        <controls:Visualizer 
                            Visibility="{Binding IsVideo, Converter={StaticResource InverseBooleanToVisibilityConverter}}"
                            ClipToBounds="True"/>
                    </Grid>
                </Border>
            </Border>

            <!-- Дебаг рамка (можно удалить) -->
            <Border BorderBrush="Red" 
                    BorderThickness="1" 
                    CornerRadius="8"
                    IsHitTestVisible="False"
                    x:Name="DebugBorder"/>
        </Grid>

        <!-- Плейлист -->
        <Border Grid.Row="3" Background="#252525" CornerRadius="8" Margin="0,10,0,10">
            <ListBox ItemsSource="{Binding Playlist}"
                     SelectedItem="{Binding CurrentTrack, Mode=TwoWay}"
                     Background="Transparent" 
                     Foreground="White"
                     BorderThickness="0">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding DisplayName}" 
                                   Foreground="White"
                                   Margin="10,5"
                                   TextTrimming="CharacterEllipsis"/>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </Border>

        <!-- Прогресс-слайдер -->
        <controls:ProgressSlider Grid.Row="4"
                             CurrentPosition="{Binding CurrentPosition, Mode=TwoWay}"
                             CurrentDuration="{Binding CurrentDuration, Mode=OneWay}"
                             SeekRequested="ProgressSlider_SeekRequested"
                             Margin="0,10,0,10"/>

        <!-- Кнопки управления -->
        <Grid Grid.Row="5" Margin="0,10,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="1" 
                        Orientation="Horizontal" 
                        HorizontalAlignment="Center" 
                        VerticalAlignment="Center">
                <Button Command="{Binding PreviousCommand}" 
                        Content="⏮" 
                        Width="60" Height="50" 
                        Margin="5" 
                        FontSize="16"
                        Background="Transparent" 
                        Foreground="White"
                        BorderThickness="0"
                        ToolTip="Previous (Left Arrow)"/>

                <Button Command="{Binding PlayPauseCommand}" 
                        Content="⏯" 
                        Width="80" Height="50" 
                        Margin="10"
                        FontSize="20"
                        Background="#007ACC" 
                        Foreground="White"
                        BorderThickness="0"
                        ToolTip="Play/Pause (Space)"/>

                <Button Command="{Binding StopCommand}" 
                        Content="⏹" 
                        Width="60" Height="50" 
                        Margin="5"
                        FontSize="16"
                        Background="Transparent" 
                        Foreground="White"
                        BorderThickness="0"
                        ToolTip="Stop (Esc)"/>

                <Button Command="{Binding NextCommand}" 
                        Content="⏭" 
                        Width="60" Height="50" 
                        Margin="5"
                        FontSize="16"
                        Background="Transparent" 
                        Foreground="White"
                        BorderThickness="0"
                        ToolTip="Next (Right Arrow)"/>
            </StackPanel>

            <controls:VolumeControl Grid.Column="2" 
                                    HorizontalAlignment="Right" 
                                    VerticalAlignment="Center" 
                                    Width="200"
                                    Margin="0,0,20,0"/>
        </Grid>
    </Grid>
</Window>